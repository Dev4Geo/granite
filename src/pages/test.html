<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IUGS QAPF Ternary Graph</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      #canvas {
        border: 1px solid #000;
      }
    </style>
  </head>
  <body>
    <h1>IUGS QAPF Ternary Graph</h1>
    <canvas id="canvas" width="800" height="700"></canvas>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const offset = 30;
      const [w, h] = [canvas.width, canvas.height];
      const left = { x: 0 + offset, y: h - offset };
      const right = { x: w - offset, y: h - offset };
      const top_ = { x: w / 2, y: 0 + offset };

      function drawTriangle() {
        drawTriangleFrame();
        drawEdgePoints();
        const d20 = drawLineParallelQ(20);
        const d60 = drawLineParallelQ(60);
        drawVerticalQ(10, d60);
        drawVerticalQ(35, d20);
        drawVerticalQ(65, d60);
        drawFivePercentLine();
        fillColor("red", [[top_.x, top_.y], [d60[1], d60[0]], [d60[2], d60[0]]]);

      }
      function fillColor(color, points){
        const oldColor = ctx.fillStyle;
        const oldAlpha = ctx.globalAlpha;
        ctx.fillStyle = color;
        ctx.globalAlpha = 0.5;
        ctx.beginPath();
        ctx.moveTo(points[0][0], points[0][1]);
        for (let i = 1; i < points.length; i++) {
          ctx.lineTo(points[i][0], points[i][1]);
        }
        ctx.closePath();
        ctx.fill();
        ctx.fillStyle = oldColor;
        ctx.globalAlpha = oldAlpha;
      }

      function plot(Q, A, P) {
        const p = getCoordinate(Q, A, P);
        drawPoint(ctx, p);
      }

      function drawPoint(ctx, point) {
        const [x, y] = point;
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, Math.PI * 2);
        ctx.fill();
      }

      function getCoordinate(Q, A, P) {
        // convert QAP to Cartesian coordinate
        const sum = Q + A + P;
        const percentageQ = Q / sum;
        const percentageA = A / sum;
        const percentageP = P / sum;
        const ratioX = percentageP / (percentageA + percentageP);
        const [y, x1, x2] = drawLineParallelQ(percentageQ * 100, (draw = false));
        console.log(y, percentageQ)
        const x = x1 + (x2 - x1) * ratioX;
        return [x, y];
      }

      function drawFivePercentLine() {
        const ratio = 5 / 100;
        const y = left.y + (top_.y - left.y) * ratio;
        const xAQ = left.x + (top_.x - left.x) * ratio;
        const xPQ = right.x + (top_.x - right.x) * ratio;

        const x65 = xAQ + (xPQ - xAQ) * 0.65;
        ctx.beginPath();
        ctx.moveTo(xAQ, y);
        ctx.lineTo(x65, y);
        ctx.stroke();
      }

      function drawVerticalQ(percentageX, d) {
        const [y, xa, xb] = d;
        const ratioX = percentageX / 100;

        const xAP = left.x + (right.x - left.x) * ratioX;
        const x = xa + (xb - xa) * ratioX;

        ctx.beginPath();
        ctx.moveTo(xAP, left.y);
        ctx.lineTo(x, y);
        ctx.stroke();
      }

      function drawTriangleFrame() {
        ctx.beginPath();
        ctx.moveTo(left.x, left.y);
        ctx.lineTo(top_.x, top_.y);
        ctx.lineTo(right.x, right.y);
        ctx.closePath();
        ctx.stroke();
      }

      function drawEdgePoints() {
        ctx.font = "20px Arial";
        ctx.fillText("Q", w / 2 - 7, 20);
        ctx.fillText("A", 0 + 7, h - offset / 2);
        ctx.fillText("P", w - offset / 2 - 2, h - offset / 2);

        ctx.beginPath();
        ctx.arc(left.x, left.y, 5, 0, Math.PI * 2);
        ctx.fill();

        ctx.beginPath();
        ctx.arc(right.x, right.y, 5, 0, Math.PI * 2);
        ctx.fill();

        ctx.beginPath();
        ctx.arc(top_.x, top.y, 5, 0, Math.PI * 2);
        ctx.fill();
      }

      function drawLineParallelQ(percentage, draw = true) {
        const ratio = percentage / 100;
        const y = left.y + (top_.y - left.y) * ratio;
        const xAQ = left.x + (top_.x - left.x) * ratio;
        const xPQ = right.x + (top_.x - right.x) * ratio;
        const x1 = xAQ;
        const x2 = xPQ;
        if (draw) {
          // draw line from pointAQ to pointPQ
          ctx.beginPath();
          ctx.moveTo(xAQ, y);
          ctx.lineTo(xPQ, y);
          ctx.stroke();
        }
        return [y, x1, x2];
      }

      // code to draw triangle
      drawTriangle();
      plot(5, 85, 10);
      plot(60, 36, 4);
    </script>
  </body>
</html>
